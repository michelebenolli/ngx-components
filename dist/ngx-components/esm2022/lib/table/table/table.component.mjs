import { Component, ContentChildren, EventEmitter, Input, Output } from '@angular/core';
import { hasValue } from '../../../utils/utils';
import { ColumnDirective } from '../column.directive';
import * as i0 from "@angular/core";
import * as i1 from "../column-templates.service";
import * as i2 from "@angular/common";
import * as i3 from "primeng/button";
import * as i4 from "primeng/api";
import * as i5 from "../../filter/filter/filter.component";
import * as i6 from "../../action/action/action.component";
import * as i7 from "primeng/table";
export class TableComponent {
    set data(value) { this.items = value; }
    constructor(tableTemplates) {
        this.tableTemplates = tableTemplates;
        this.params = {};
        this.pageSize = 10;
        this.changed = new EventEmitter();
        this.onColReordered = new EventEmitter();
    }
    ngOnInit() {
        this.params.filters = this.filters?.map(x => x.request)?.filter(x => hasValue(x));
    }
    clearSelection() {
        this.selected = [];
    }
    sort(event) {
        const direction = (event.order == 1) ? 'asc' : 'desc';
        this.params.orderBy = event.field?.split(' ')?.map(x => x + ' ' + direction);
        this.changed.emit(this.params);
    }
    pageChange(event) {
        this.params.pageNumber = event.first / event.rows + 1;
        this.params.pageSize = event.rows;
        this.changed.emit(this.params);
    }
    filter(requests) {
        this.params.pageNumber = 1;
        this.params.filters = requests.filter(x => hasValue(x));
        this.changed.emit(this.params);
    }
    // TODO: Called too many times... replace it with a array of templates
    // To populate when the component loads...
    getTemplate(name) {
        return this.templates?.find(x => x.id === name)?.template ??
            this.tableTemplates.directives.find(x => x.id === name)?.template ?? null;
    }
    onColReorder(event) {
        this.onColReordered.emit(event);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, deps: [{ token: i1.ColumnTemplates }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.0", type: TableComponent, selector: "g-table", inputs: { columns: "columns", params: "params", actions: "actions", tableActions: "tableActions", bulkActions: "bulkActions", filters: "filters", totalItems: "totalItems", pageSize: "pageSize", data: "data" }, outputs: { changed: "changed", onColReordered: "onColReordered" }, queries: [{ propertyName: "templates", predicate: ColumnDirective }], ngImport: i0, template: "<!-- Bulk actions -->\n<div *ngIf=\"bulkActions?.length && selected?.length\" class=\"d-flex justify-content-between p-3 mb-3 rounded bg-light\">\n  <p-button [label]=\"'Annulla selezione'\" (click)=\"clearSelection()\" styleClass=\"p-button-outlined p-button-secondary\" />\n  <g-action [data]=\"selected\" [actions]=\"bulkActions\" class=\"d-flex gap-2\">\n    <ng-template #template let-action>\n      <p-button [label]=\"action.label\" />\n    </ng-template>\n  </g-action>\n</div>\n\n<!-- Table filters and actions -->\n<div *ngIf=\"filters?.length || tableActions?.length\" class=\"d-flex gap-3 justify-content-between align-items-center pb-3 overflow-auto\">\n  <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n  <g-action *ngIf=\"tableActions?.length\" [actions]=\"tableActions\" class=\"d-flex gap-2\">\n    <ng-template #template let-action>\n      <p-button [label]=\"action.label\" />\n    </ng-template>\n  </g-action>\n</div>\n\n<!-- Table -->\n<p-table [resizableColumns]=\"true\" [value]=\"items ?? []\" responsiveLayout=\"scroll\" (onSort)=\"sort($event)\"\n  [customSort]=\"true\" [lazy]=\"true\" [(selection)]=\"selected\" [columns]=\"columns\"\n  [reorderableColumns]=\"true\" (onColReorder)=\"onColReorder($event)\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onPage)=\"pageChange($event)\">\n  \n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      <th style=\"width:0\" *ngIf=\"bulkActions?.length\">\n        <p-tableHeaderCheckbox />\n      </th>\n      <th *ngFor=\"let column of columns\" [pSortableColumn]=\"column.sort ?? ''\" pReorderableColumn>\n        {{column.name}} <p-sortIcon *ngIf=\"column.sort\" [field]=\"column.sort\" />\n      </th>\n      <th *ngIf=\"actions\" class=\"text-end\" style=\"width:0\"></th>\n    </tr>\n  </ng-template>\n\n  <!-- Table body -->\n  <ng-template pTemplate=\"body\" let-item let-rowIndex=\"rowIndex\">\n    <tr [pSelectableRow]=\"item\" [pSelectableRowIndex]=\"rowIndex\">\n      <td *ngIf=\"bulkActions?.length\">\n        <p-tableCheckbox [value]=\"item\" />\n      </td>\n      <td *ngFor=\"let column of columns;\">\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : template\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n      <td class=\"text-end\" *ngIf=\"actions\">\n        <g-action [data]=\"item\" [actions]=\"actions\" />\n      </td>\n    </tr>\n  </ng-template>\n\n  <ng-template pTemplate=\"emptymessage\">\n    <tr>\n      <td class=\"mat-cell text-center\" [attr.colspan]=\"100\">\n        {{ 'Nessun elemento da visualizzare' }} <!-- // TODO: Translate -->\n      </td>\n    </tr>\n  </ng-template>\n  <ng-template pTemplate=\"paginatorleft\"></ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #template let-item let-column=\"column\">\n  {{ column.value(item) }}\n\n  <!--@switch (column.type) {\n    @case (DataType.Date) {\n        {{ column.value(item) | date: 'dd/MM/yyyy' }}\n    }\n    @case (DataType.DateTime) {\n        {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n    }\n    @case (DataType.Amount) {\n        {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n    }\n    @case (DataType.Bool) {\n        {{ column.value(item) ? 'Si': 'No' }}\n    }\n    @default {\n        {{ column.value(item) }}\n    }\n  }-->\n</ng-template>", styles: [":host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;height:3.5rem}\n"], dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i3.Button, selector: "p-button", inputs: ["type", "iconPos", "icon", "badge", "label", "disabled", "loading", "loadingIcon", "raised", "rounded", "text", "plain", "severity", "outlined", "link", "size", "style", "styleClass", "badgeClass", "ariaLabel"], outputs: ["onClick", "onFocus", "onBlur"] }, { kind: "directive", type: i4.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "component", type: i5.FilterComponent, selector: "app-filter", inputs: ["filters"], outputs: ["onFilter"] }, { kind: "component", type: i6.ActionComponent, selector: "g-action", inputs: ["actions", "data"] }, { kind: "component", type: i7.Table, selector: "p-table", inputs: ["frozenColumns", "frozenValue", "style", "styleClass", "tableStyle", "tableStyleClass", "paginator", "pageLinks", "rowsPerPageOptions", "alwaysShowPaginator", "paginatorPosition", "paginatorStyleClass", "paginatorDropdownAppendTo", "paginatorDropdownScrollHeight", "currentPageReportTemplate", "showCurrentPageReport", "showJumpToPageDropdown", "showJumpToPageInput", "showFirstLastIcon", "showPageLinks", "defaultSortOrder", "sortMode", "resetPageOnSort", "selectionMode", "selectionPageOnly", "contextMenuSelection", "contextMenuSelectionMode", "dataKey", "metaKeySelection", "rowSelectable", "rowTrackBy", "lazy", "lazyLoadOnInit", "compareSelectionBy", "csvSeparator", "exportFilename", "filters", "globalFilterFields", "filterDelay", "filterLocale", "expandedRowKeys", "editingRowKeys", "rowExpandMode", "scrollable", "scrollDirection", "rowGroupMode", "scrollHeight", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "virtualScrollDelay", "frozenWidth", "responsive", "contextMenu", "resizableColumns", "columnResizeMode", "reorderableColumns", "loading", "loadingIcon", "showLoader", "rowHover", "customSort", "showInitialSortBadge", "autoLayout", "exportFunction", "exportHeader", "stateKey", "stateStorage", "editMode", "groupRowsBy", "groupRowsByOrder", "responsiveLayout", "breakpoint", "paginatorLocale", "value", "columns", "first", "rows", "totalRecords", "sortField", "sortOrder", "multiSortMeta", "selection", "selectAll", "virtualRowHeight"], outputs: ["contextMenuSelectionChange", "selectAllChange", "selectionChange", "onRowSelect", "onRowUnselect", "onPage", "onSort", "onFilter", "onLazyLoad", "onRowExpand", "onRowCollapse", "onContextMenuSelect", "onColResize", "onColReorder", "onRowReorder", "onEditInit", "onEditComplete", "onEditCancel", "onHeaderCheckboxToggle", "sortFunction", "firstChange", "rowsChange", "onStateSave", "onStateRestore"] }, { kind: "directive", type: i7.SortableColumn, selector: "[pSortableColumn]", inputs: ["pSortableColumn", "pSortableColumnDisabled"] }, { kind: "directive", type: i7.SelectableRow, selector: "[pSelectableRow]", inputs: ["pSelectableRow", "pSelectableRowIndex", "pSelectableRowDisabled"] }, { kind: "directive", type: i7.ReorderableColumn, selector: "[pReorderableColumn]", inputs: ["pReorderableColumnDisabled"] }, { kind: "component", type: i7.SortIcon, selector: "p-sortIcon", inputs: ["field"] }, { kind: "component", type: i7.TableCheckbox, selector: "p-tableCheckbox", inputs: ["disabled", "value", "index", "inputId", "name", "required", "ariaLabel"] }, { kind: "component", type: i7.TableHeaderCheckbox, selector: "p-tableHeaderCheckbox", inputs: ["disabled", "inputId", "name", "ariaLabel"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'g-table', template: "<!-- Bulk actions -->\n<div *ngIf=\"bulkActions?.length && selected?.length\" class=\"d-flex justify-content-between p-3 mb-3 rounded bg-light\">\n  <p-button [label]=\"'Annulla selezione'\" (click)=\"clearSelection()\" styleClass=\"p-button-outlined p-button-secondary\" />\n  <g-action [data]=\"selected\" [actions]=\"bulkActions\" class=\"d-flex gap-2\">\n    <ng-template #template let-action>\n      <p-button [label]=\"action.label\" />\n    </ng-template>\n  </g-action>\n</div>\n\n<!-- Table filters and actions -->\n<div *ngIf=\"filters?.length || tableActions?.length\" class=\"d-flex gap-3 justify-content-between align-items-center pb-3 overflow-auto\">\n  <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n  <g-action *ngIf=\"tableActions?.length\" [actions]=\"tableActions\" class=\"d-flex gap-2\">\n    <ng-template #template let-action>\n      <p-button [label]=\"action.label\" />\n    </ng-template>\n  </g-action>\n</div>\n\n<!-- Table -->\n<p-table [resizableColumns]=\"true\" [value]=\"items ?? []\" responsiveLayout=\"scroll\" (onSort)=\"sort($event)\"\n  [customSort]=\"true\" [lazy]=\"true\" [(selection)]=\"selected\" [columns]=\"columns\"\n  [reorderableColumns]=\"true\" (onColReorder)=\"onColReorder($event)\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onPage)=\"pageChange($event)\">\n  \n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      <th style=\"width:0\" *ngIf=\"bulkActions?.length\">\n        <p-tableHeaderCheckbox />\n      </th>\n      <th *ngFor=\"let column of columns\" [pSortableColumn]=\"column.sort ?? ''\" pReorderableColumn>\n        {{column.name}} <p-sortIcon *ngIf=\"column.sort\" [field]=\"column.sort\" />\n      </th>\n      <th *ngIf=\"actions\" class=\"text-end\" style=\"width:0\"></th>\n    </tr>\n  </ng-template>\n\n  <!-- Table body -->\n  <ng-template pTemplate=\"body\" let-item let-rowIndex=\"rowIndex\">\n    <tr [pSelectableRow]=\"item\" [pSelectableRowIndex]=\"rowIndex\">\n      <td *ngIf=\"bulkActions?.length\">\n        <p-tableCheckbox [value]=\"item\" />\n      </td>\n      <td *ngFor=\"let column of columns;\">\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : template\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n      <td class=\"text-end\" *ngIf=\"actions\">\n        <g-action [data]=\"item\" [actions]=\"actions\" />\n      </td>\n    </tr>\n  </ng-template>\n\n  <ng-template pTemplate=\"emptymessage\">\n    <tr>\n      <td class=\"mat-cell text-center\" [attr.colspan]=\"100\">\n        {{ 'Nessun elemento da visualizzare' }} <!-- // TODO: Translate -->\n      </td>\n    </tr>\n  </ng-template>\n  <ng-template pTemplate=\"paginatorleft\"></ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #template let-item let-column=\"column\">\n  {{ column.value(item) }}\n\n  <!--@switch (column.type) {\n    @case (DataType.Date) {\n        {{ column.value(item) | date: 'dd/MM/yyyy' }}\n    }\n    @case (DataType.DateTime) {\n        {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n    }\n    @case (DataType.Amount) {\n        {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n    }\n    @case (DataType.Bool) {\n        {{ column.value(item) ? 'Si': 'No' }}\n    }\n    @default {\n        {{ column.value(item) }}\n    }\n  }-->\n</ng-template>", styles: [":host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;height:3.5rem}\n"] }]
        }], ctorParameters: () => [{ type: i1.ColumnTemplates }], propDecorators: { columns: [{
                type: Input
            }], params: [{
                type: Input
            }], actions: [{
                type: Input
            }], tableActions: [{
                type: Input
            }], bulkActions: [{
                type: Input
            }], filters: [{
                type: Input
            }], totalItems: [{
                type: Input
            }], pageSize: [{
                type: Input
            }], data: [{
                type: Input
            }], changed: [{
                type: Output
            }], onColReordered: [{
                type: Output
            }], templates: [{
                type: ContentChildren,
                args: [ColumnDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWNvbXBvbmVudHMvc3JjL2xpYi90YWJsZS90YWJsZS90YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtY29tcG9uZW50cy9zcmMvbGliL3RhYmxlL3RhYmxlL3RhYmxlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUEwQixNQUFNLGVBQWUsQ0FBQztBQUd4SCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJaEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7Ozs7Ozs7QUFRdEQsTUFBTSxPQUFPLGNBQWM7SUFVekIsSUFBYSxJQUFJLENBQUMsS0FBd0IsSUFBSSxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQSxDQUFDLENBQUM7SUFRbEUsWUFBb0IsY0FBK0I7UUFBL0IsbUJBQWMsR0FBZCxjQUFjLENBQWlCO1FBZjFDLFdBQU0sR0FBUSxFQUFHLENBQUM7UUFNbEIsYUFBUSxHQUFZLEVBQUUsQ0FBQztRQUd0QixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM3QixtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7SUFLSSxDQUFDO0lBRXhELFFBQVE7UUFDTixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwRixDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLENBQUMsS0FBZ0I7UUFDbkIsTUFBTSxTQUFTLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUN0RCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLFNBQVMsQ0FBQyxDQUFDO1FBQzdFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQVU7UUFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsTUFBTSxDQUFDLFFBQXlCO1FBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxzRUFBc0U7SUFDdEUsMENBQTBDO0lBQzFDLFdBQVcsQ0FBQyxJQUFZO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLFFBQVE7WUFDdkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxRQUFRLElBQUksSUFBSSxDQUFDO0lBQzlFLENBQUM7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNyQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDOzhHQXZEVSxjQUFjO2tHQUFkLGNBQWMsOFZBY1IsZUFBZSw2QkM3QmxDLG9sSEF3RmM7OzJGRHpFRCxjQUFjO2tCQUwxQixTQUFTOytCQUNFLFNBQVM7b0ZBTVYsT0FBTztzQkFBZixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ08sSUFBSTtzQkFBaEIsS0FBSztnQkFFSSxPQUFPO3NCQUFoQixNQUFNO2dCQUNHLGNBQWM7c0JBQXZCLE1BQU07Z0JBQzJCLFNBQVM7c0JBQTFDLGVBQWU7dUJBQUMsZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgUXVlcnlMaXN0LCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU29ydEV2ZW50IH0gZnJvbSAncHJpbWVuZy9hcGknO1xuaW1wb3J0IHsgRmlsdGVyUmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9maWx0ZXItcmVxdWVzdCc7XG5pbXBvcnQgeyBoYXNWYWx1ZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9maWx0ZXInO1xuaW1wb3J0IHsgVGFibGVDb2x1bW4gfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvdGFibGUtY29sdW1uJztcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9hY3Rpb24nO1xuaW1wb3J0IHsgQ29sdW1uRGlyZWN0aXZlIH0gZnJvbSAnLi4vY29sdW1uLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBDb2x1bW5UZW1wbGF0ZXMgfSBmcm9tICcuLi9jb2x1bW4tdGVtcGxhdGVzLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdnLXRhYmxlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RhYmxlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFibGUuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYWJsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KCkgY29sdW1ucyE6IFRhYmxlQ29sdW1uW107XG4gIEBJbnB1dCgpIHBhcmFtczogYW55ID0geyB9O1xuICBASW5wdXQoKSBhY3Rpb25zPzogQWN0aW9uW107XG4gIEBJbnB1dCgpIHRhYmxlQWN0aW9ucz86IEFjdGlvbltdO1xuICBASW5wdXQoKSBidWxrQWN0aW9ucz86IEFjdGlvbltdO1xuICBASW5wdXQoKSBmaWx0ZXJzPzogRmlsdGVyW107XG4gIEBJbnB1dCgpIHRvdGFsSXRlbXM/OiBudW1iZXI7XG4gIEBJbnB1dCgpIHBhZ2VTaXplPzogbnVtYmVyID0gMTA7XG4gIEBJbnB1dCgpIHNldCBkYXRhKHZhbHVlOiBhbnlbXSB8IHVuZGVmaW5lZCkgeyB0aGlzLml0ZW1zID0gdmFsdWUgfVxuXG4gIEBPdXRwdXQoKSBjaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgb25Db2xSZW9yZGVyZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQENvbnRlbnRDaGlsZHJlbihDb2x1bW5EaXJlY3RpdmUpIHRlbXBsYXRlcz86IFF1ZXJ5TGlzdDxDb2x1bW5EaXJlY3RpdmU+O1xuICBpdGVtcz86IGFueVtdO1xuICBzZWxlY3RlZD86IGFueVtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdGFibGVUZW1wbGF0ZXM6IENvbHVtblRlbXBsYXRlcykgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5wYXJhbXMuZmlsdGVycyA9IHRoaXMuZmlsdGVycz8ubWFwKHggPT4geC5yZXF1ZXN0KT8uZmlsdGVyKHggPT4gaGFzVmFsdWUoeCkpO1xuICB9XG5cbiAgY2xlYXJTZWxlY3Rpb24oKSB7XG4gICAgdGhpcy5zZWxlY3RlZCA9IFtdO1xuICB9XG5cbiAgc29ydChldmVudDogU29ydEV2ZW50KSB7XG4gICAgY29uc3QgZGlyZWN0aW9uID0gKGV2ZW50Lm9yZGVyID09IDEpID8gJ2FzYycgOiAnZGVzYyc7XG4gICAgdGhpcy5wYXJhbXMub3JkZXJCeSA9IGV2ZW50LmZpZWxkPy5zcGxpdCgnICcpPy5tYXAoeCA9PiB4ICsgJyAnICsgZGlyZWN0aW9uKTtcbiAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLnBhcmFtcyk7XG4gIH1cblxuICBwYWdlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnBhcmFtcy5wYWdlTnVtYmVyID0gZXZlbnQuZmlyc3QgLyBldmVudC5yb3dzICsgMTtcbiAgICB0aGlzLnBhcmFtcy5wYWdlU2l6ZSA9IGV2ZW50LnJvd3M7XG4gICAgdGhpcy5jaGFuZ2VkLmVtaXQodGhpcy5wYXJhbXMpO1xuICB9XG5cbiAgZmlsdGVyKHJlcXVlc3RzOiBGaWx0ZXJSZXF1ZXN0W10pIHtcbiAgICB0aGlzLnBhcmFtcy5wYWdlTnVtYmVyID0gMTtcbiAgICB0aGlzLnBhcmFtcy5maWx0ZXJzID0gcmVxdWVzdHMuZmlsdGVyKHggPT4gaGFzVmFsdWUoeCkpO1xuICAgIHRoaXMuY2hhbmdlZC5lbWl0KHRoaXMucGFyYW1zKTtcbiAgfVxuXG4gIC8vIFRPRE86IENhbGxlZCB0b28gbWFueSB0aW1lcy4uLiByZXBsYWNlIGl0IHdpdGggYSBhcnJheSBvZiB0ZW1wbGF0ZXNcbiAgLy8gVG8gcG9wdWxhdGUgd2hlbiB0aGUgY29tcG9uZW50IGxvYWRzLi4uXG4gIGdldFRlbXBsYXRlKG5hbWU6IHN0cmluZyk6IFRlbXBsYXRlUmVmPGFueT4gfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZXM/LmZpbmQoeCA9PiB4LmlkID09PSBuYW1lKT8udGVtcGxhdGUgPz9cbiAgICAgIHRoaXMudGFibGVUZW1wbGF0ZXMuZGlyZWN0aXZlcy5maW5kKHggPT4geC5pZCA9PT0gbmFtZSk/LnRlbXBsYXRlID8/IG51bGw7XG4gIH1cblxuICBvbkNvbFJlb3JkZXIoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMub25Db2xSZW9yZGVyZWQuZW1pdChldmVudCk7XG4gIH1cbn1cbiIsIjwhLS0gQnVsayBhY3Rpb25zIC0tPlxuPGRpdiAqbmdJZj1cImJ1bGtBY3Rpb25zPy5sZW5ndGggJiYgc2VsZWN0ZWQ/Lmxlbmd0aFwiIGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuIHAtMyBtYi0zIHJvdW5kZWQgYmctbGlnaHRcIj5cbiAgPHAtYnV0dG9uIFtsYWJlbF09XCInQW5udWxsYSBzZWxlemlvbmUnXCIgKGNsaWNrKT1cImNsZWFyU2VsZWN0aW9uKClcIiBzdHlsZUNsYXNzPVwicC1idXR0b24tb3V0bGluZWQgcC1idXR0b24tc2Vjb25kYXJ5XCIgLz5cbiAgPGctYWN0aW9uIFtkYXRhXT1cInNlbGVjdGVkXCIgW2FjdGlvbnNdPVwiYnVsa0FjdGlvbnNcIiBjbGFzcz1cImQtZmxleCBnYXAtMlwiPlxuICAgIDxuZy10ZW1wbGF0ZSAjdGVtcGxhdGUgbGV0LWFjdGlvbj5cbiAgICAgIDxwLWJ1dHRvbiBbbGFiZWxdPVwiYWN0aW9uLmxhYmVsXCIgLz5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L2ctYWN0aW9uPlxuPC9kaXY+XG5cbjwhLS0gVGFibGUgZmlsdGVycyBhbmQgYWN0aW9ucyAtLT5cbjxkaXYgKm5nSWY9XCJmaWx0ZXJzPy5sZW5ndGggfHwgdGFibGVBY3Rpb25zPy5sZW5ndGhcIiBjbGFzcz1cImQtZmxleCBnYXAtMyBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiBhbGlnbi1pdGVtcy1jZW50ZXIgcGItMyBvdmVyZmxvdy1hdXRvXCI+XG4gIDxhcHAtZmlsdGVyIFtmaWx0ZXJzXT1cImZpbHRlcnNcIiAob25GaWx0ZXIpPVwiZmlsdGVyKCRldmVudClcIiBjbGFzcz1cImZsZXgtZ3Jvdy0xXCIgLz5cbiAgPGctYWN0aW9uICpuZ0lmPVwidGFibGVBY3Rpb25zPy5sZW5ndGhcIiBbYWN0aW9uc109XCJ0YWJsZUFjdGlvbnNcIiBjbGFzcz1cImQtZmxleCBnYXAtMlwiPlxuICAgIDxuZy10ZW1wbGF0ZSAjdGVtcGxhdGUgbGV0LWFjdGlvbj5cbiAgICAgIDxwLWJ1dHRvbiBbbGFiZWxdPVwiYWN0aW9uLmxhYmVsXCIgLz5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L2ctYWN0aW9uPlxuPC9kaXY+XG5cbjwhLS0gVGFibGUgLS0+XG48cC10YWJsZSBbcmVzaXphYmxlQ29sdW1uc109XCJ0cnVlXCIgW3ZhbHVlXT1cIml0ZW1zID8/IFtdXCIgcmVzcG9uc2l2ZUxheW91dD1cInNjcm9sbFwiIChvblNvcnQpPVwic29ydCgkZXZlbnQpXCJcbiAgW2N1c3RvbVNvcnRdPVwidHJ1ZVwiIFtsYXp5XT1cInRydWVcIiBbKHNlbGVjdGlvbildPVwic2VsZWN0ZWRcIiBbY29sdW1uc109XCJjb2x1bW5zXCJcbiAgW3Jlb3JkZXJhYmxlQ29sdW1uc109XCJ0cnVlXCIgKG9uQ29sUmVvcmRlcik9XCJvbkNvbFJlb3JkZXIoJGV2ZW50KVwiXG4gIFtwYWdpbmF0b3JdPVwidHJ1ZVwiIFthbHdheXNTaG93UGFnaW5hdG9yXT1cImZhbHNlXCIgW3RvdGFsUmVjb3Jkc109XCJ0b3RhbEl0ZW1zID8/IGl0ZW1zPy5sZW5ndGggPz8gMFwiIFtyb3dzXT1cInBhZ2VTaXplXCJcbiAgW3Nob3dDdXJyZW50UGFnZVJlcG9ydF09XCJ0cnVlXCIgY3VycmVudFBhZ2VSZXBvcnRUZW1wbGF0ZT1cIntmaXJzdH0gLSB7bGFzdH0gZGkge3RvdGFsUmVjb3Jkc31cIlxuICBbcm93c1BlclBhZ2VPcHRpb25zXT1cIls1LCAxMCwgMjUsIDEwMF1cIiAob25QYWdlKT1cInBhZ2VDaGFuZ2UoJGV2ZW50KVwiPlxuICBcbiAgPCEtLSBUYWJsZSBoZWFkZXIgLS0+XG4gIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJoZWFkZXJcIj5cbiAgICA8dHI+XG4gICAgICA8dGggc3R5bGU9XCJ3aWR0aDowXCIgKm5nSWY9XCJidWxrQWN0aW9ucz8ubGVuZ3RoXCI+XG4gICAgICAgIDxwLXRhYmxlSGVhZGVyQ2hlY2tib3ggLz5cbiAgICAgIDwvdGg+XG4gICAgICA8dGggKm5nRm9yPVwibGV0IGNvbHVtbiBvZiBjb2x1bW5zXCIgW3BTb3J0YWJsZUNvbHVtbl09XCJjb2x1bW4uc29ydCA/PyAnJ1wiIHBSZW9yZGVyYWJsZUNvbHVtbj5cbiAgICAgICAge3tjb2x1bW4ubmFtZX19IDxwLXNvcnRJY29uICpuZ0lmPVwiY29sdW1uLnNvcnRcIiBbZmllbGRdPVwiY29sdW1uLnNvcnRcIiAvPlxuICAgICAgPC90aD5cbiAgICAgIDx0aCAqbmdJZj1cImFjdGlvbnNcIiBjbGFzcz1cInRleHQtZW5kXCIgc3R5bGU9XCJ3aWR0aDowXCI+PC90aD5cbiAgICA8L3RyPlxuICA8L25nLXRlbXBsYXRlPlxuXG4gIDwhLS0gVGFibGUgYm9keSAtLT5cbiAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImJvZHlcIiBsZXQtaXRlbSBsZXQtcm93SW5kZXg9XCJyb3dJbmRleFwiPlxuICAgIDx0ciBbcFNlbGVjdGFibGVSb3ddPVwiaXRlbVwiIFtwU2VsZWN0YWJsZVJvd0luZGV4XT1cInJvd0luZGV4XCI+XG4gICAgICA8dGQgKm5nSWY9XCJidWxrQWN0aW9ucz8ubGVuZ3RoXCI+XG4gICAgICAgIDxwLXRhYmxlQ2hlY2tib3ggW3ZhbHVlXT1cIml0ZW1cIiAvPlxuICAgICAgPC90ZD5cbiAgICAgIDx0ZCAqbmdGb3I9XCJsZXQgY29sdW1uIG9mIGNvbHVtbnM7XCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29sdW1uLnRlbXBsYXRlID8gZ2V0VGVtcGxhdGUoY29sdW1uLnRlbXBsYXRlKSA6IHRlbXBsYXRlXCJcbiAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IGl0ZW0sIGNvbHVtbiB9XCIgLz5cbiAgICAgIDwvdGQ+XG4gICAgICA8dGQgY2xhc3M9XCJ0ZXh0LWVuZFwiICpuZ0lmPVwiYWN0aW9uc1wiPlxuICAgICAgICA8Zy1hY3Rpb24gW2RhdGFdPVwiaXRlbVwiIFthY3Rpb25zXT1cImFjdGlvbnNcIiAvPlxuICAgICAgPC90ZD5cbiAgICA8L3RyPlxuICA8L25nLXRlbXBsYXRlPlxuXG4gIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJlbXB0eW1lc3NhZ2VcIj5cbiAgICA8dHI+XG4gICAgICA8dGQgY2xhc3M9XCJtYXQtY2VsbCB0ZXh0LWNlbnRlclwiIFthdHRyLmNvbHNwYW5dPVwiMTAwXCI+XG4gICAgICAgIHt7ICdOZXNzdW4gZWxlbWVudG8gZGEgdmlzdWFsaXp6YXJlJyB9fSA8IS0tIC8vIFRPRE86IFRyYW5zbGF0ZSAtLT5cbiAgICAgIDwvdGQ+XG4gICAgPC90cj5cbiAgPC9uZy10ZW1wbGF0ZT5cbiAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cInBhZ2luYXRvcmxlZnRcIj48L25nLXRlbXBsYXRlPlxuPC9wLXRhYmxlPlxuXG48IS0tIFRhYmxlIGRhdGEgdGVtcGxhdGUgLS0+XG48bmctdGVtcGxhdGUgI3RlbXBsYXRlIGxldC1pdGVtIGxldC1jb2x1bW49XCJjb2x1bW5cIj5cbiAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIH19XG5cbiAgPCEtLUBzd2l0Y2ggKGNvbHVtbi50eXBlKSB7XG4gICAgQGNhc2UgKERhdGFUeXBlLkRhdGUpIHtcbiAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIHwgZGF0ZTogJ2RkL01NL3l5eXknIH19XG4gICAgfVxuICAgIEBjYXNlIChEYXRhVHlwZS5EYXRlVGltZSkge1xuICAgICAgICB7eyBjb2x1bW4udmFsdWUoaXRlbSkgfCBkYXRlOiAnZGQvTU0veXl5eSwgaGg6bW0nIH19XG4gICAgfVxuICAgIEBjYXNlIChEYXRhVHlwZS5BbW91bnQpIHtcbiAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIHwgY3VycmVuY3k6ICdFVVInOiAnc3ltYm9sJyA6IHVuZGVmaW5lZDogJ2l0LUlUJyB9fVxuICAgIH1cbiAgICBAY2FzZSAoRGF0YVR5cGUuQm9vbCkge1xuICAgICAgICB7eyBjb2x1bW4udmFsdWUoaXRlbSkgPyAnU2knOiAnTm8nIH19XG4gICAgfVxuICAgIEBkZWZhdWx0IHtcbiAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIH19XG4gICAgfVxuICB9LS0+XG48L25nLXRlbXBsYXRlPiJdfQ==