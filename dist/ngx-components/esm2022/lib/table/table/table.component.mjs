import { Component, ContentChildren, EventEmitter, Input, Output } from '@angular/core';
import { hasValue } from '../../../utils/utils';
import { DataType } from '../../../models/data-type';
import { TableColumnDirective } from '../table-column.directive';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "primeng/button";
import * as i3 from "primeng/api";
import * as i4 from "../../filter/filter/filter.component";
import * as i5 from "../../action/action/action.component";
import * as i6 from "primeng/table";
export class TableComponent {
    constructor() {
        this.params = {};
        this.pageSize = 10;
        this.changed = new EventEmitter();
        this.DataType = DataType;
    }
    set data(value) { this.items = value; }
    getTemplate(name) {
        return this.templates?.find(x => x.id === name)?.template ?? null;
    }
    // TODO: What if actions are not empty but all not vsible?
    // Do not show table caption/action column!
    // TODO: CEll height, borders of table
    // TODO: Implement multiple-column sort
    sort(event) {
        const active = this.columns.find(x => x.sort === event.field)?.sort;
        if (active) {
            const direction = event.order == 1 ? 'asc' : 'desc';
            this.params.orderBy = [active + ' ' + direction];
            this.changed.emit(this.params);
        }
    }
    pageChange(event) {
        this.params.pageNumber = event.first / event.rows + 1;
        this.params.pageSize = event.rows;
        this.changed.emit(this.params);
    }
    // TODO: Page not changed when filter!!
    filter(requests) {
        if (this.totalItems)
            this.params.pageNumber = 1;
        this.params.filters = requests.filter(x => hasValue(x));
        this.changed.emit(this.params);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.2.0", type: TableComponent, selector: "app-table", inputs: { columns: "columns", actions: "actions", globalActions: "globalActions", filters: "filters", params: "params", totalItems: "totalItems", pageSize: "pageSize", data: "data" }, outputs: { changed: "changed" }, queries: [{ propertyName: "templates", predicate: TableColumnDirective }], ngImport: i0, template: "<!-- // TODO: Show paginator only when paging is active... -->\n<!-- // TODO: Check the condition of [totalRecords]-->\n<p-table [value]=\"items ?? []\" [lazy]=\"true\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onSort)=\"sort($event)\" (onPage)=\"pageChange($event)\">\n\n  <!-- Table filters and actions -->\n  @if (filters?.length || globalActions?.length) {\n    <ng-template pTemplate=\"caption\">\n      <div class=\"d-flex align-items-center overflow-auto p-3\">\n        <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n        @if (globalActions?.length) {\n          <app-action [actions]=\"globalActions\" class=\"ms-2\">\n            <ng-template #template let-action>\n              <p-button [label]=\"action.label\" styleClass=\"p-button-primary ms-2\" />\n            </ng-template>\n          </app-action>\n        }\n      </div>\n    </ng-template>\n  }\n\n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      @for (column of columns; track column) {\n        <th [pSortableColumn]=\"column.sort\">\n          {{column.name}} \n          @if (column.sort) {\n            <p-sortIcon [field]=\"column.sort\" />\n            }\n      </th>\n    }\n    @if (actions) {\n      <th class=\"text-end\"></th>\n    }\n  </tr>\n</ng-template>\n\n<!-- Table body -->\n<ng-template pTemplate=\"body\" let-item>\n  <tr>\n    @for (column of columns; track column) {\n      <td>\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : tableTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n    }\n    @if (actions) {\n      <td class=\"text-end\">\n        <app-action [actions]=\"actions\" [data]=\"item\" />\n      </td>\n    }\n  </tr>\n</ng-template>\n\n<ng-template pTemplate=\"emptymessage\">\n  <tr>\n    <td [attr.colspan]=\"100\">\n      {{ 'Nessun elemento da visualizzare' }}\n    </td>\n  </tr>\n</ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #tableTemplate let-item let-column=\"column\">\n  @switch (column.type) {\n        @case (DataType.Date) {\n            {{ column.value(item) | date: 'dd/MM/yyyy' }}\n        }\n        @case (DataType.DateTime) {\n            {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n        }\n        @case (DataType.Amount) {\n            {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n        }\n        @case (DataType.Bool) {\n            {{ column.value(item) ? 'Si': 'No' }}\n        <!-- // TODO: Translate -->\n        }\n        @case (DataType.Color) {\n            <i class=\"bi bi-circle-fill\" [style.color]=\"column.value(item)\"></i>\n        }\n        @default {\n            {{ column.value(item) }}\n        }\n    }\n  </ng-template>", styles: [":host::ng-deep .p-datatable{border:2px solid transparent;border-radius:5px}:host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;min-height:37px}:host::ng-deep .p-datatable .p-datatable-header{background-color:#fff;padding:0}\n"], dependencies: [{ kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i2.Button, selector: "p-button", inputs: ["type", "iconPos", "icon", "badge", "label", "disabled", "loading", "loadingIcon", "raised", "rounded", "text", "plain", "severity", "outlined", "link", "size", "style", "styleClass", "badgeClass", "ariaLabel"], outputs: ["onClick", "onFocus", "onBlur"] }, { kind: "directive", type: i3.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "component", type: i4.FilterComponent, selector: "app-filter", inputs: ["filters"], outputs: ["onFilter"] }, { kind: "component", type: i5.ActionComponent, selector: "app-action", inputs: ["actions", "data"] }, { kind: "component", type: i6.Table, selector: "p-table", inputs: ["frozenColumns", "frozenValue", "style", "styleClass", "tableStyle", "tableStyleClass", "paginator", "pageLinks", "rowsPerPageOptions", "alwaysShowPaginator", "paginatorPosition", "paginatorStyleClass", "paginatorDropdownAppendTo", "paginatorDropdownScrollHeight", "currentPageReportTemplate", "showCurrentPageReport", "showJumpToPageDropdown", "showJumpToPageInput", "showFirstLastIcon", "showPageLinks", "defaultSortOrder", "sortMode", "resetPageOnSort", "selectionMode", "selectionPageOnly", "contextMenuSelection", "contextMenuSelectionMode", "dataKey", "metaKeySelection", "rowSelectable", "rowTrackBy", "lazy", "lazyLoadOnInit", "compareSelectionBy", "csvSeparator", "exportFilename", "filters", "globalFilterFields", "filterDelay", "filterLocale", "expandedRowKeys", "editingRowKeys", "rowExpandMode", "scrollable", "scrollDirection", "rowGroupMode", "scrollHeight", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "virtualScrollDelay", "frozenWidth", "responsive", "contextMenu", "resizableColumns", "columnResizeMode", "reorderableColumns", "loading", "loadingIcon", "showLoader", "rowHover", "customSort", "showInitialSortBadge", "autoLayout", "exportFunction", "exportHeader", "stateKey", "stateStorage", "editMode", "groupRowsBy", "groupRowsByOrder", "responsiveLayout", "breakpoint", "paginatorLocale", "value", "columns", "first", "rows", "totalRecords", "sortField", "sortOrder", "multiSortMeta", "selection", "selectAll", "virtualRowHeight"], outputs: ["contextMenuSelectionChange", "selectAllChange", "selectionChange", "onRowSelect", "onRowUnselect", "onPage", "onSort", "onFilter", "onLazyLoad", "onRowExpand", "onRowCollapse", "onContextMenuSelect", "onColResize", "onColReorder", "onRowReorder", "onEditInit", "onEditComplete", "onEditCancel", "onHeaderCheckboxToggle", "sortFunction", "firstChange", "rowsChange", "onStateSave", "onStateRestore"] }, { kind: "directive", type: i6.SortableColumn, selector: "[pSortableColumn]", inputs: ["pSortableColumn", "pSortableColumnDisabled"] }, { kind: "component", type: i6.SortIcon, selector: "p-sortIcon", inputs: ["field"] }, { kind: "pipe", type: i1.CurrencyPipe, name: "currency" }, { kind: "pipe", type: i1.DatePipe, name: "date" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-table', template: "<!-- // TODO: Show paginator only when paging is active... -->\n<!-- // TODO: Check the condition of [totalRecords]-->\n<p-table [value]=\"items ?? []\" [lazy]=\"true\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onSort)=\"sort($event)\" (onPage)=\"pageChange($event)\">\n\n  <!-- Table filters and actions -->\n  @if (filters?.length || globalActions?.length) {\n    <ng-template pTemplate=\"caption\">\n      <div class=\"d-flex align-items-center overflow-auto p-3\">\n        <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n        @if (globalActions?.length) {\n          <app-action [actions]=\"globalActions\" class=\"ms-2\">\n            <ng-template #template let-action>\n              <p-button [label]=\"action.label\" styleClass=\"p-button-primary ms-2\" />\n            </ng-template>\n          </app-action>\n        }\n      </div>\n    </ng-template>\n  }\n\n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      @for (column of columns; track column) {\n        <th [pSortableColumn]=\"column.sort\">\n          {{column.name}} \n          @if (column.sort) {\n            <p-sortIcon [field]=\"column.sort\" />\n            }\n      </th>\n    }\n    @if (actions) {\n      <th class=\"text-end\"></th>\n    }\n  </tr>\n</ng-template>\n\n<!-- Table body -->\n<ng-template pTemplate=\"body\" let-item>\n  <tr>\n    @for (column of columns; track column) {\n      <td>\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : tableTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n    }\n    @if (actions) {\n      <td class=\"text-end\">\n        <app-action [actions]=\"actions\" [data]=\"item\" />\n      </td>\n    }\n  </tr>\n</ng-template>\n\n<ng-template pTemplate=\"emptymessage\">\n  <tr>\n    <td [attr.colspan]=\"100\">\n      {{ 'Nessun elemento da visualizzare' }}\n    </td>\n  </tr>\n</ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #tableTemplate let-item let-column=\"column\">\n  @switch (column.type) {\n        @case (DataType.Date) {\n            {{ column.value(item) | date: 'dd/MM/yyyy' }}\n        }\n        @case (DataType.DateTime) {\n            {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n        }\n        @case (DataType.Amount) {\n            {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n        }\n        @case (DataType.Bool) {\n            {{ column.value(item) ? 'Si': 'No' }}\n        <!-- // TODO: Translate -->\n        }\n        @case (DataType.Color) {\n            <i class=\"bi bi-circle-fill\" [style.color]=\"column.value(item)\"></i>\n        }\n        @default {\n            {{ column.value(item) }}\n        }\n    }\n  </ng-template>", styles: [":host::ng-deep .p-datatable{border:2px solid transparent;border-radius:5px}:host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;min-height:37px}:host::ng-deep .p-datatable .p-datatable-header{background-color:#fff;padding:0}\n"] }]
        }], propDecorators: { columns: [{
                type: Input
            }], actions: [{
                type: Input
            }], globalActions: [{
                type: Input
            }], filters: [{
                type: Input
            }], params: [{
                type: Input
            }], totalItems: [{
                type: Input
            }], pageSize: [{
                type: Input
            }], data: [{
                type: Input
            }], changed: [{
                type: Output
            }], templates: [{
                type: ContentChildren,
                args: [TableColumnDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWNvbXBvbmVudHMvc3JjL2xpYi90YWJsZS90YWJsZS90YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtY29tcG9uZW50cy9zcmMvbGliL3RhYmxlL3RhYmxlL3RhYmxlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUEwQixNQUFNLGVBQWUsQ0FBQztBQUdoSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFLaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDOzs7Ozs7OztBQU9qRSxNQUFNLE9BQU8sY0FBYztJQUwzQjtRQVdXLFdBQU0sR0FBUSxFQUFHLENBQUM7UUFHbEIsYUFBUSxHQUFZLEVBQUUsQ0FBQztRQUd0QixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUd2QyxhQUFRLEdBQUcsUUFBUSxDQUFDO0tBZ0NyQjtJQXBDQyxJQUFhLElBQUksQ0FBQyxLQUFzQixJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBLENBQUMsQ0FBQztJQU1oRSxXQUFXLENBQUMsSUFBWTtRQUN0QixPQUFPLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxRQUFRLElBQUksSUFBSSxDQUFDO0lBQ3BFLENBQUM7SUFFRCwwREFBMEQ7SUFDMUQsMkNBQTJDO0lBQzNDLHNDQUFzQztJQUV0Qyx1Q0FBdUM7SUFDdkMsSUFBSSxDQUFDLEtBQWdCO1FBQ25CLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDO1FBQ3BFLElBQUksTUFBTSxFQUFFLENBQUM7WUFDWCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDcEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxHQUFHLFNBQVMsQ0FBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFxQjtRQUM5QixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCx1Q0FBdUM7SUFDdkMsTUFBTSxDQUFDLFFBQXlCO1FBQzlCLElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDOzhHQTlDVSxjQUFjO2tHQUFkLGNBQWMsb1NBYVIsb0JBQW9CLDZCQzdCdkMsNitGQXlGZ0I7OzJGRHpFSCxjQUFjO2tCQUwxQixTQUFTOytCQUNFLFdBQVc7OEJBTVosT0FBTztzQkFBZixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBRUcsVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUVPLElBQUk7c0JBQWhCLEtBQUs7Z0JBQ0ksT0FBTztzQkFBaEIsTUFBTTtnQkFDZ0MsU0FBUztzQkFBL0MsZUFBZTt1QkFBQyxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBRdWVyeUxpc3QsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTb3J0RXZlbnQgfSBmcm9tICdwcmltZW5nL2FwaSc7XG5pbXBvcnQgeyBGaWx0ZXJSZXF1ZXN0IH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2ZpbHRlci1yZXF1ZXN0JztcbmltcG9ydCB7IGhhc1ZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2ZpbHRlcic7XG5pbXBvcnQgeyBUYWJsZUNvbHVtbiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy90YWJsZS1jb2x1bW4nO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2FjdGlvbic7XG5pbXBvcnQgeyBUYWJsZVBhZ2VFdmVudCB9IGZyb20gJ3ByaW1lbmcvdGFibGUnO1xuaW1wb3J0IHsgRGF0YVR5cGUgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvZGF0YS10eXBlJztcbmltcG9ydCB7IFRhYmxlQ29sdW1uRGlyZWN0aXZlIH0gZnJvbSAnLi4vdGFibGUtY29sdW1uLmRpcmVjdGl2ZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC10YWJsZScsXG4gIHRlbXBsYXRlVXJsOiAnLi90YWJsZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RhYmxlLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVGFibGVDb21wb25lbnQ8VD4ge1xuXG4gIEBJbnB1dCgpIGNvbHVtbnMhOiBUYWJsZUNvbHVtbjxUPltdO1xuICBASW5wdXQoKSBhY3Rpb25zPzogQWN0aW9uPFQ+W107XG4gIEBJbnB1dCgpIGdsb2JhbEFjdGlvbnM/OiBBY3Rpb248VD5bXTtcbiAgQElucHV0KCkgZmlsdGVycz86IEZpbHRlcltdO1xuICBASW5wdXQoKSBwYXJhbXM6IGFueSA9IHsgfTtcblxuICBASW5wdXQoKSB0b3RhbEl0ZW1zPzogbnVtYmVyO1xuICBASW5wdXQoKSBwYWdlU2l6ZT86IG51bWJlciA9IDEwO1xuXG4gIEBJbnB1dCgpIHNldCBkYXRhKHZhbHVlOiBUW10gfCB1bmRlZmluZWQpIHsgdGhpcy5pdGVtcyA9IHZhbHVlIH1cbiAgQE91dHB1dCgpIGNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBDb250ZW50Q2hpbGRyZW4oVGFibGVDb2x1bW5EaXJlY3RpdmUpIHRlbXBsYXRlcz86IFF1ZXJ5TGlzdDxUYWJsZUNvbHVtbkRpcmVjdGl2ZT47XG4gIGl0ZW1zPzogVFtdO1xuICBEYXRhVHlwZSA9IERhdGFUeXBlO1xuXG4gIGdldFRlbXBsYXRlKG5hbWU6IHN0cmluZyk6IFRlbXBsYXRlUmVmPGFueT4gfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZXM/LmZpbmQoeCA9PiB4LmlkID09PSBuYW1lKT8udGVtcGxhdGUgPz8gbnVsbDtcbiAgfVxuXG4gIC8vIFRPRE86IFdoYXQgaWYgYWN0aW9ucyBhcmUgbm90IGVtcHR5IGJ1dCBhbGwgbm90IHZzaWJsZT9cbiAgLy8gRG8gbm90IHNob3cgdGFibGUgY2FwdGlvbi9hY3Rpb24gY29sdW1uIVxuICAvLyBUT0RPOiBDRWxsIGhlaWdodCwgYm9yZGVycyBvZiB0YWJsZVxuXG4gIC8vIFRPRE86IEltcGxlbWVudCBtdWx0aXBsZS1jb2x1bW4gc29ydFxuICBzb3J0KGV2ZW50OiBTb3J0RXZlbnQpIHtcbiAgICBjb25zdCBhY3RpdmUgPSB0aGlzLmNvbHVtbnMuZmluZCh4ID0+IHguc29ydCA9PT0gZXZlbnQuZmllbGQpPy5zb3J0O1xuICAgIGlmIChhY3RpdmUpIHtcbiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGV2ZW50Lm9yZGVyID09IDEgPyAnYXNjJyA6ICdkZXNjJztcbiAgICAgIHRoaXMucGFyYW1zLm9yZGVyQnkgPSBbYWN0aXZlICsgJyAnICsgZGlyZWN0aW9uXTtcbiAgICAgIHRoaXMuY2hhbmdlZC5lbWl0KHRoaXMucGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICBwYWdlQ2hhbmdlKGV2ZW50OiBUYWJsZVBhZ2VFdmVudCkge1xuICAgIHRoaXMucGFyYW1zLnBhZ2VOdW1iZXIgPSBldmVudC5maXJzdCAvIGV2ZW50LnJvd3MgKyAxO1xuICAgIHRoaXMucGFyYW1zLnBhZ2VTaXplID0gZXZlbnQucm93cztcbiAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLnBhcmFtcyk7XG4gIH1cblxuICAvLyBUT0RPOiBQYWdlIG5vdCBjaGFuZ2VkIHdoZW4gZmlsdGVyISFcbiAgZmlsdGVyKHJlcXVlc3RzOiBGaWx0ZXJSZXF1ZXN0W10pIHtcbiAgICBpZiAodGhpcy50b3RhbEl0ZW1zKSB0aGlzLnBhcmFtcy5wYWdlTnVtYmVyID0gMTtcbiAgICB0aGlzLnBhcmFtcy5maWx0ZXJzID0gcmVxdWVzdHMuZmlsdGVyKHggPT4gaGFzVmFsdWUoeCkpO1xuICAgIHRoaXMuY2hhbmdlZC5lbWl0KHRoaXMucGFyYW1zKTtcbiAgfVxufVxuIiwiPCEtLSAvLyBUT0RPOiBTaG93IHBhZ2luYXRvciBvbmx5IHdoZW4gcGFnaW5nIGlzIGFjdGl2ZS4uLiAtLT5cbjwhLS0gLy8gVE9ETzogQ2hlY2sgdGhlIGNvbmRpdGlvbiBvZiBbdG90YWxSZWNvcmRzXS0tPlxuPHAtdGFibGUgW3ZhbHVlXT1cIml0ZW1zID8/IFtdXCIgW2xhenldPVwidHJ1ZVwiXG4gIFtwYWdpbmF0b3JdPVwidHJ1ZVwiIFthbHdheXNTaG93UGFnaW5hdG9yXT1cImZhbHNlXCIgW3RvdGFsUmVjb3Jkc109XCJ0b3RhbEl0ZW1zID8/IGl0ZW1zPy5sZW5ndGggPz8gMFwiIFtyb3dzXT1cInBhZ2VTaXplXCJcbiAgW3Nob3dDdXJyZW50UGFnZVJlcG9ydF09XCJ0cnVlXCIgY3VycmVudFBhZ2VSZXBvcnRUZW1wbGF0ZT1cIntmaXJzdH0gLSB7bGFzdH0gZGkge3RvdGFsUmVjb3Jkc31cIlxuICBbcm93c1BlclBhZ2VPcHRpb25zXT1cIls1LCAxMCwgMjUsIDEwMF1cIiAob25Tb3J0KT1cInNvcnQoJGV2ZW50KVwiIChvblBhZ2UpPVwicGFnZUNoYW5nZSgkZXZlbnQpXCI+XG5cbiAgPCEtLSBUYWJsZSBmaWx0ZXJzIGFuZCBhY3Rpb25zIC0tPlxuICBAaWYgKGZpbHRlcnM/Lmxlbmd0aCB8fCBnbG9iYWxBY3Rpb25zPy5sZW5ndGgpIHtcbiAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiY2FwdGlvblwiPlxuICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIgb3ZlcmZsb3ctYXV0byBwLTNcIj5cbiAgICAgICAgPGFwcC1maWx0ZXIgW2ZpbHRlcnNdPVwiZmlsdGVyc1wiIChvbkZpbHRlcik9XCJmaWx0ZXIoJGV2ZW50KVwiIGNsYXNzPVwiZmxleC1ncm93LTFcIiAvPlxuICAgICAgICBAaWYgKGdsb2JhbEFjdGlvbnM/Lmxlbmd0aCkge1xuICAgICAgICAgIDxhcHAtYWN0aW9uIFthY3Rpb25zXT1cImdsb2JhbEFjdGlvbnNcIiBjbGFzcz1cIm1zLTJcIj5cbiAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSAjdGVtcGxhdGUgbGV0LWFjdGlvbj5cbiAgICAgICAgICAgICAgPHAtYnV0dG9uIFtsYWJlbF09XCJhY3Rpb24ubGFiZWxcIiBzdHlsZUNsYXNzPVwicC1idXR0b24tcHJpbWFyeSBtcy0yXCIgLz5cbiAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgPC9hcHAtYWN0aW9uPlxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICB9XG5cbiAgPCEtLSBUYWJsZSBoZWFkZXIgLS0+XG4gIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJoZWFkZXJcIj5cbiAgICA8dHI+XG4gICAgICBAZm9yIChjb2x1bW4gb2YgY29sdW1uczsgdHJhY2sgY29sdW1uKSB7XG4gICAgICAgIDx0aCBbcFNvcnRhYmxlQ29sdW1uXT1cImNvbHVtbi5zb3J0XCI+XG4gICAgICAgICAge3tjb2x1bW4ubmFtZX19IFxuICAgICAgICAgIEBpZiAoY29sdW1uLnNvcnQpIHtcbiAgICAgICAgICAgIDxwLXNvcnRJY29uIFtmaWVsZF09XCJjb2x1bW4uc29ydFwiIC8+XG4gICAgICAgICAgICB9XG4gICAgICA8L3RoPlxuICAgIH1cbiAgICBAaWYgKGFjdGlvbnMpIHtcbiAgICAgIDx0aCBjbGFzcz1cInRleHQtZW5kXCI+PC90aD5cbiAgICB9XG4gIDwvdHI+XG48L25nLXRlbXBsYXRlPlxuXG48IS0tIFRhYmxlIGJvZHkgLS0+XG48bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiYm9keVwiIGxldC1pdGVtPlxuICA8dHI+XG4gICAgQGZvciAoY29sdW1uIG9mIGNvbHVtbnM7IHRyYWNrIGNvbHVtbikge1xuICAgICAgPHRkPlxuICAgICAgICA8bmctY29udGFpbmVyIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImNvbHVtbi50ZW1wbGF0ZSA/IGdldFRlbXBsYXRlKGNvbHVtbi50ZW1wbGF0ZSkgOiB0YWJsZVRlbXBsYXRlXCJcbiAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IGl0ZW0sIGNvbHVtbiB9XCIgLz5cbiAgICAgIDwvdGQ+XG4gICAgfVxuICAgIEBpZiAoYWN0aW9ucykge1xuICAgICAgPHRkIGNsYXNzPVwidGV4dC1lbmRcIj5cbiAgICAgICAgPGFwcC1hY3Rpb24gW2FjdGlvbnNdPVwiYWN0aW9uc1wiIFtkYXRhXT1cIml0ZW1cIiAvPlxuICAgICAgPC90ZD5cbiAgICB9XG4gIDwvdHI+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiZW1wdHltZXNzYWdlXCI+XG4gIDx0cj5cbiAgICA8dGQgW2F0dHIuY29sc3Bhbl09XCIxMDBcIj5cbiAgICAgIHt7ICdOZXNzdW4gZWxlbWVudG8gZGEgdmlzdWFsaXp6YXJlJyB9fVxuICAgIDwvdGQ+XG4gIDwvdHI+XG48L25nLXRlbXBsYXRlPlxuPC9wLXRhYmxlPlxuXG48IS0tIFRhYmxlIGRhdGEgdGVtcGxhdGUgLS0+XG48bmctdGVtcGxhdGUgI3RhYmxlVGVtcGxhdGUgbGV0LWl0ZW0gbGV0LWNvbHVtbj1cImNvbHVtblwiPlxuICBAc3dpdGNoIChjb2x1bW4udHlwZSkge1xuICAgICAgICBAY2FzZSAoRGF0YVR5cGUuRGF0ZSkge1xuICAgICAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIHwgZGF0ZTogJ2RkL01NL3l5eXknIH19XG4gICAgICAgIH1cbiAgICAgICAgQGNhc2UgKERhdGFUeXBlLkRhdGVUaW1lKSB7XG4gICAgICAgICAgICB7eyBjb2x1bW4udmFsdWUoaXRlbSkgfCBkYXRlOiAnZGQvTU0veXl5eSwgaGg6bW0nIH19XG4gICAgICAgIH1cbiAgICAgICAgQGNhc2UgKERhdGFUeXBlLkFtb3VudCkge1xuICAgICAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIHwgY3VycmVuY3k6ICdFVVInOiAnc3ltYm9sJyA6IHVuZGVmaW5lZDogJ2l0LUlUJyB9fVxuICAgICAgICB9XG4gICAgICAgIEBjYXNlIChEYXRhVHlwZS5Cb29sKSB7XG4gICAgICAgICAgICB7eyBjb2x1bW4udmFsdWUoaXRlbSkgPyAnU2knOiAnTm8nIH19XG4gICAgICAgIDwhLS0gLy8gVE9ETzogVHJhbnNsYXRlIC0tPlxuICAgICAgICB9XG4gICAgICAgIEBjYXNlIChEYXRhVHlwZS5Db2xvcikge1xuICAgICAgICAgICAgPGkgY2xhc3M9XCJiaSBiaS1jaXJjbGUtZmlsbFwiIFtzdHlsZS5jb2xvcl09XCJjb2x1bW4udmFsdWUoaXRlbSlcIj48L2k+XG4gICAgICAgIH1cbiAgICAgICAgQGRlZmF1bHQge1xuICAgICAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIH19XG4gICAgICAgIH1cbiAgICB9XG4gIDwvbmctdGVtcGxhdGU+Il19