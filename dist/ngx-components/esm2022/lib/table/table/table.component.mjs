import { Component, ContentChildren, EventEmitter, Input, Output } from '@angular/core';
import { hasValue } from '../../../utils/utils';
import { DataType } from '../../../models/data-type';
import { TableColumnDirective } from '../table-column.directive';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "primeng/button";
import * as i3 from "primeng/api";
import * as i4 from "../../filter/filter/filter.component";
import * as i5 from "../../action/action/action.component";
import * as i6 from "primeng/table";
export class TableComponent {
    constructor() {
        this.params = {};
        this.pageSize = 10;
        this.changed = new EventEmitter();
        this.DataType = DataType;
    }
    set data(value) { this.items = value; }
    getTemplate(name) {
        return this.templates?.find(x => x.id === name)?.template ?? null;
    }
    // TODO: What if actions are not empty but all not vsible?
    // Do not show table caption/action column!
    // TODO: CEll height, borders of table
    // TODO: Implement multiple-column sort
    sort(event) {
        const active = this.columns.find(x => x.sort === event.field)?.sort;
        if (active) {
            const direction = event.order == 1 ? 'asc' : 'desc';
            this.params.orderBy = [active + ' ' + direction];
            this.changed.emit(this.params);
        }
    }
    pageChange(event) {
        this.params.pageNumber = event.first / event.rows + 1;
        this.params.pageSize = event.rows;
        this.changed.emit(this.params);
    }
    // TODO: Page not changed when filter!!
    filter(requests) {
        if (this.totalItems)
            this.params.pageNumber = 1;
        this.params.filters = requests.filter(x => hasValue(x));
        this.changed.emit(this.params);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.2.0", type: TableComponent, selector: "g-table", inputs: { columns: "columns", actions: "actions", globalActions: "globalActions", filters: "filters", params: "params", totalItems: "totalItems", pageSize: "pageSize", data: "data" }, outputs: { changed: "changed" }, queries: [{ propertyName: "templates", predicate: TableColumnDirective }], ngImport: i0, template: "<!-- // TODO: Show paginator only when paging is active... -->\n<!-- // TODO: Check the condition of [totalRecords]-->\n<p-table [value]=\"items ?? []\" [lazy]=\"true\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onSort)=\"sort($event)\" (onPage)=\"pageChange($event)\">\n\n  <!-- Table filters and actions -->\n  @if (filters?.length || globalActions?.length) {\n    <ng-template pTemplate=\"caption\">\n      <div class=\"d-flex align-items-center overflow-auto p-3\">\n        <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n        @if (globalActions?.length) {\n          <app-action [actions]=\"globalActions\" class=\"ms-2\">\n            <ng-template #template let-action>\n              <p-button [label]=\"action.label\" styleClass=\"p-button-primary ms-2\" />\n            </ng-template>\n          </app-action>\n        }\n      </div>\n    </ng-template>\n  }\n\n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      @for (column of columns; track column) {\n        <th [pSortableColumn]=\"column.sort\">\n          {{column.name}} \n          @if (column.sort) {\n            <p-sortIcon [field]=\"column.sort\" />\n            }\n      </th>\n    }\n    @if (actions) {\n      <th class=\"text-end\"></th>\n    }\n  </tr>\n</ng-template>\n\n<!-- Table body -->\n<ng-template pTemplate=\"body\" let-item>\n  <tr>\n    @for (column of columns; track column) {\n      <td>\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : tableTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n    }\n    @if (actions) {\n      <td class=\"text-end\">\n        <app-action [actions]=\"actions\" [data]=\"item\" />\n      </td>\n    }\n  </tr>\n</ng-template>\n\n<ng-template pTemplate=\"emptymessage\">\n  <tr>\n    <td [attr.colspan]=\"100\">\n      {{ 'Nessun elemento da visualizzare' }}\n    </td>\n  </tr>\n</ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #tableTemplate let-item let-column=\"column\">\n  @switch (column.type) {\n        @case (DataType.Date) {\n            {{ column.value(item) | date: 'dd/MM/yyyy' }}\n        }\n        @case (DataType.DateTime) {\n            {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n        }\n        @case (DataType.Amount) {\n            {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n        }\n        @case (DataType.Bool) {\n            {{ column.value(item) ? 'Si': 'No' }}\n        <!-- // TODO: Translate -->\n        }\n        @case (DataType.Color) {\n            <i class=\"bi bi-circle-fill\" [style.color]=\"column.value(item)\"></i>\n        }\n        @default {\n            {{ column.value(item) }}\n        }\n    }\n  </ng-template>", styles: [":host::ng-deep .p-datatable{border:2px solid transparent;border-radius:5px}:host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;min-height:37px}:host::ng-deep .p-datatable .p-datatable-header{background-color:#fff;padding:0}\n"], dependencies: [{ kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i2.Button, selector: "p-button", inputs: ["type", "iconPos", "icon", "badge", "label", "disabled", "loading", "loadingIcon", "raised", "rounded", "text", "plain", "severity", "outlined", "link", "size", "style", "styleClass", "badgeClass", "ariaLabel"], outputs: ["onClick", "onFocus", "onBlur"] }, { kind: "directive", type: i3.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "component", type: i4.FilterComponent, selector: "app-filter", inputs: ["filters"], outputs: ["onFilter"] }, { kind: "component", type: i5.ActionComponent, selector: "app-action", inputs: ["actions", "data"] }, { kind: "component", type: i6.Table, selector: "p-table", inputs: ["frozenColumns", "frozenValue", "style", "styleClass", "tableStyle", "tableStyleClass", "paginator", "pageLinks", "rowsPerPageOptions", "alwaysShowPaginator", "paginatorPosition", "paginatorStyleClass", "paginatorDropdownAppendTo", "paginatorDropdownScrollHeight", "currentPageReportTemplate", "showCurrentPageReport", "showJumpToPageDropdown", "showJumpToPageInput", "showFirstLastIcon", "showPageLinks", "defaultSortOrder", "sortMode", "resetPageOnSort", "selectionMode", "selectionPageOnly", "contextMenuSelection", "contextMenuSelectionMode", "dataKey", "metaKeySelection", "rowSelectable", "rowTrackBy", "lazy", "lazyLoadOnInit", "compareSelectionBy", "csvSeparator", "exportFilename", "filters", "globalFilterFields", "filterDelay", "filterLocale", "expandedRowKeys", "editingRowKeys", "rowExpandMode", "scrollable", "scrollDirection", "rowGroupMode", "scrollHeight", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "virtualScrollDelay", "frozenWidth", "responsive", "contextMenu", "resizableColumns", "columnResizeMode", "reorderableColumns", "loading", "loadingIcon", "showLoader", "rowHover", "customSort", "showInitialSortBadge", "autoLayout", "exportFunction", "exportHeader", "stateKey", "stateStorage", "editMode", "groupRowsBy", "groupRowsByOrder", "responsiveLayout", "breakpoint", "paginatorLocale", "value", "columns", "first", "rows", "totalRecords", "sortField", "sortOrder", "multiSortMeta", "selection", "selectAll", "virtualRowHeight"], outputs: ["contextMenuSelectionChange", "selectAllChange", "selectionChange", "onRowSelect", "onRowUnselect", "onPage", "onSort", "onFilter", "onLazyLoad", "onRowExpand", "onRowCollapse", "onContextMenuSelect", "onColResize", "onColReorder", "onRowReorder", "onEditInit", "onEditComplete", "onEditCancel", "onHeaderCheckboxToggle", "sortFunction", "firstChange", "rowsChange", "onStateSave", "onStateRestore"] }, { kind: "directive", type: i6.SortableColumn, selector: "[pSortableColumn]", inputs: ["pSortableColumn", "pSortableColumnDisabled"] }, { kind: "component", type: i6.SortIcon, selector: "p-sortIcon", inputs: ["field"] }, { kind: "pipe", type: i1.CurrencyPipe, name: "currency" }, { kind: "pipe", type: i1.DatePipe, name: "date" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.0", ngImport: i0, type: TableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'g-table', template: "<!-- // TODO: Show paginator only when paging is active... -->\n<!-- // TODO: Check the condition of [totalRecords]-->\n<p-table [value]=\"items ?? []\" [lazy]=\"true\"\n  [paginator]=\"true\" [alwaysShowPaginator]=\"false\" [totalRecords]=\"totalItems ?? items?.length ?? 0\" [rows]=\"pageSize\"\n  [showCurrentPageReport]=\"true\" currentPageReportTemplate=\"{first} - {last} di {totalRecords}\"\n  [rowsPerPageOptions]=\"[5, 10, 25, 100]\" (onSort)=\"sort($event)\" (onPage)=\"pageChange($event)\">\n\n  <!-- Table filters and actions -->\n  @if (filters?.length || globalActions?.length) {\n    <ng-template pTemplate=\"caption\">\n      <div class=\"d-flex align-items-center overflow-auto p-3\">\n        <app-filter [filters]=\"filters\" (onFilter)=\"filter($event)\" class=\"flex-grow-1\" />\n        @if (globalActions?.length) {\n          <app-action [actions]=\"globalActions\" class=\"ms-2\">\n            <ng-template #template let-action>\n              <p-button [label]=\"action.label\" styleClass=\"p-button-primary ms-2\" />\n            </ng-template>\n          </app-action>\n        }\n      </div>\n    </ng-template>\n  }\n\n  <!-- Table header -->\n  <ng-template pTemplate=\"header\">\n    <tr>\n      @for (column of columns; track column) {\n        <th [pSortableColumn]=\"column.sort\">\n          {{column.name}} \n          @if (column.sort) {\n            <p-sortIcon [field]=\"column.sort\" />\n            }\n      </th>\n    }\n    @if (actions) {\n      <th class=\"text-end\"></th>\n    }\n  </tr>\n</ng-template>\n\n<!-- Table body -->\n<ng-template pTemplate=\"body\" let-item>\n  <tr>\n    @for (column of columns; track column) {\n      <td>\n        <ng-container [ngTemplateOutlet]=\"column.template ? getTemplate(column.template) : tableTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: item, column }\" />\n      </td>\n    }\n    @if (actions) {\n      <td class=\"text-end\">\n        <app-action [actions]=\"actions\" [data]=\"item\" />\n      </td>\n    }\n  </tr>\n</ng-template>\n\n<ng-template pTemplate=\"emptymessage\">\n  <tr>\n    <td [attr.colspan]=\"100\">\n      {{ 'Nessun elemento da visualizzare' }}\n    </td>\n  </tr>\n</ng-template>\n</p-table>\n\n<!-- Table data template -->\n<ng-template #tableTemplate let-item let-column=\"column\">\n  @switch (column.type) {\n        @case (DataType.Date) {\n            {{ column.value(item) | date: 'dd/MM/yyyy' }}\n        }\n        @case (DataType.DateTime) {\n            {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}\n        }\n        @case (DataType.Amount) {\n            {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}\n        }\n        @case (DataType.Bool) {\n            {{ column.value(item) ? 'Si': 'No' }}\n        <!-- // TODO: Translate -->\n        }\n        @case (DataType.Color) {\n            <i class=\"bi bi-circle-fill\" [style.color]=\"column.value(item)\"></i>\n        }\n        @default {\n            {{ column.value(item) }}\n        }\n    }\n  </ng-template>", styles: [":host::ng-deep .p-datatable{border:2px solid transparent;border-radius:5px}:host::ng-deep .p-datatable .p-datatable-tbody>tr>td{padding:.5rem 1rem;min-height:37px}:host::ng-deep .p-datatable .p-datatable-header{background-color:#fff;padding:0}\n"] }]
        }], propDecorators: { columns: [{
                type: Input
            }], actions: [{
                type: Input
            }], globalActions: [{
                type: Input
            }], filters: [{
                type: Input
            }], params: [{
                type: Input
            }], totalItems: [{
                type: Input
            }], pageSize: [{
                type: Input
            }], data: [{
                type: Input
            }], changed: [{
                type: Output
            }], templates: [{
                type: ContentChildren,
                args: [TableColumnDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWNvbXBvbmVudHMvc3JjL2xpYi90YWJsZS90YWJsZS90YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtY29tcG9uZW50cy9zcmMvbGliL3RhYmxlL3RhYmxlL3RhYmxlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUEwQixNQUFNLGVBQWUsQ0FBQztBQUdoSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFLaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDOzs7Ozs7OztBQU9qRSxNQUFNLE9BQU8sY0FBYztJQUwzQjtRQVdXLFdBQU0sR0FBUSxFQUFHLENBQUM7UUFHbEIsYUFBUSxHQUFZLEVBQUUsQ0FBQztRQUd0QixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUd2QyxhQUFRLEdBQUcsUUFBUSxDQUFDO0tBZ0NyQjtJQXBDQyxJQUFhLElBQUksQ0FBQyxLQUFzQixJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBLENBQUMsQ0FBQztJQU1oRSxXQUFXLENBQUMsSUFBWTtRQUN0QixPQUFPLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxRQUFRLElBQUksSUFBSSxDQUFDO0lBQ3BFLENBQUM7SUFFRCwwREFBMEQ7SUFDMUQsMkNBQTJDO0lBQzNDLHNDQUFzQztJQUV0Qyx1Q0FBdUM7SUFDdkMsSUFBSSxDQUFDLEtBQWdCO1FBQ25CLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDO1FBQ3BFLElBQUksTUFBTSxFQUFFLENBQUM7WUFDWCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDcEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxHQUFHLFNBQVMsQ0FBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFxQjtRQUM5QixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCx1Q0FBdUM7SUFDdkMsTUFBTSxDQUFDLFFBQXlCO1FBQzlCLElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDOzhHQTlDVSxjQUFjO2tHQUFkLGNBQWMsa1NBYVIsb0JBQW9CLDZCQzdCdkMsNitGQXlGZ0I7OzJGRHpFSCxjQUFjO2tCQUwxQixTQUFTOytCQUNFLFNBQVM7OEJBTVYsT0FBTztzQkFBZixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBRUcsVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUVPLElBQUk7c0JBQWhCLEtBQUs7Z0JBQ0ksT0FBTztzQkFBaEIsTUFBTTtnQkFDZ0MsU0FBUztzQkFBL0MsZUFBZTt1QkFBQyxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBRdWVyeUxpc3QsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTb3J0RXZlbnQgfSBmcm9tICdwcmltZW5nL2FwaSc7XG5pbXBvcnQgeyBGaWx0ZXJSZXF1ZXN0IH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2ZpbHRlci1yZXF1ZXN0JztcbmltcG9ydCB7IGhhc1ZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2ZpbHRlcic7XG5pbXBvcnQgeyBUYWJsZUNvbHVtbiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy90YWJsZS1jb2x1bW4nO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL2FjdGlvbic7XG5pbXBvcnQgeyBUYWJsZVBhZ2VFdmVudCB9IGZyb20gJ3ByaW1lbmcvdGFibGUnO1xuaW1wb3J0IHsgRGF0YVR5cGUgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvZGF0YS10eXBlJztcbmltcG9ydCB7IFRhYmxlQ29sdW1uRGlyZWN0aXZlIH0gZnJvbSAnLi4vdGFibGUtY29sdW1uLmRpcmVjdGl2ZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ctdGFibGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFibGUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90YWJsZS5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFRhYmxlQ29tcG9uZW50PFQ+IHtcblxuICBASW5wdXQoKSBjb2x1bW5zITogVGFibGVDb2x1bW48VD5bXTtcbiAgQElucHV0KCkgYWN0aW9ucz86IEFjdGlvbjxUPltdO1xuICBASW5wdXQoKSBnbG9iYWxBY3Rpb25zPzogQWN0aW9uPFQ+W107XG4gIEBJbnB1dCgpIGZpbHRlcnM/OiBGaWx0ZXJbXTtcbiAgQElucHV0KCkgcGFyYW1zOiBhbnkgPSB7IH07XG5cbiAgQElucHV0KCkgdG90YWxJdGVtcz86IG51bWJlcjtcbiAgQElucHV0KCkgcGFnZVNpemU/OiBudW1iZXIgPSAxMDtcblxuICBASW5wdXQoKSBzZXQgZGF0YSh2YWx1ZTogVFtdIHwgdW5kZWZpbmVkKSB7IHRoaXMuaXRlbXMgPSB2YWx1ZSB9XG4gIEBPdXRwdXQoKSBjaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAQ29udGVudENoaWxkcmVuKFRhYmxlQ29sdW1uRGlyZWN0aXZlKSB0ZW1wbGF0ZXM/OiBRdWVyeUxpc3Q8VGFibGVDb2x1bW5EaXJlY3RpdmU+O1xuICBpdGVtcz86IFRbXTtcbiAgRGF0YVR5cGUgPSBEYXRhVHlwZTtcblxuICBnZXRUZW1wbGF0ZShuYW1lOiBzdHJpbmcpOiBUZW1wbGF0ZVJlZjxhbnk+IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudGVtcGxhdGVzPy5maW5kKHggPT4geC5pZCA9PT0gbmFtZSk/LnRlbXBsYXRlID8/IG51bGw7XG4gIH1cblxuICAvLyBUT0RPOiBXaGF0IGlmIGFjdGlvbnMgYXJlIG5vdCBlbXB0eSBidXQgYWxsIG5vdCB2c2libGU/XG4gIC8vIERvIG5vdCBzaG93IHRhYmxlIGNhcHRpb24vYWN0aW9uIGNvbHVtbiFcbiAgLy8gVE9ETzogQ0VsbCBoZWlnaHQsIGJvcmRlcnMgb2YgdGFibGVcblxuICAvLyBUT0RPOiBJbXBsZW1lbnQgbXVsdGlwbGUtY29sdW1uIHNvcnRcbiAgc29ydChldmVudDogU29ydEV2ZW50KSB7XG4gICAgY29uc3QgYWN0aXZlID0gdGhpcy5jb2x1bW5zLmZpbmQoeCA9PiB4LnNvcnQgPT09IGV2ZW50LmZpZWxkKT8uc29ydDtcbiAgICBpZiAoYWN0aXZlKSB7XG4gICAgICBjb25zdCBkaXJlY3Rpb24gPSBldmVudC5vcmRlciA9PSAxID8gJ2FzYycgOiAnZGVzYyc7XG4gICAgICB0aGlzLnBhcmFtcy5vcmRlckJ5ID0gW2FjdGl2ZSArICcgJyArIGRpcmVjdGlvbl07XG4gICAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLnBhcmFtcyk7XG4gICAgfVxuICB9XG5cbiAgcGFnZUNoYW5nZShldmVudDogVGFibGVQYWdlRXZlbnQpIHtcbiAgICB0aGlzLnBhcmFtcy5wYWdlTnVtYmVyID0gZXZlbnQuZmlyc3QgLyBldmVudC5yb3dzICsgMTtcbiAgICB0aGlzLnBhcmFtcy5wYWdlU2l6ZSA9IGV2ZW50LnJvd3M7XG4gICAgdGhpcy5jaGFuZ2VkLmVtaXQodGhpcy5wYXJhbXMpO1xuICB9XG5cbiAgLy8gVE9ETzogUGFnZSBub3QgY2hhbmdlZCB3aGVuIGZpbHRlciEhXG4gIGZpbHRlcihyZXF1ZXN0czogRmlsdGVyUmVxdWVzdFtdKSB7XG4gICAgaWYgKHRoaXMudG90YWxJdGVtcykgdGhpcy5wYXJhbXMucGFnZU51bWJlciA9IDE7XG4gICAgdGhpcy5wYXJhbXMuZmlsdGVycyA9IHJlcXVlc3RzLmZpbHRlcih4ID0+IGhhc1ZhbHVlKHgpKTtcbiAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLnBhcmFtcyk7XG4gIH1cbn1cbiIsIjwhLS0gLy8gVE9ETzogU2hvdyBwYWdpbmF0b3Igb25seSB3aGVuIHBhZ2luZyBpcyBhY3RpdmUuLi4gLS0+XG48IS0tIC8vIFRPRE86IENoZWNrIHRoZSBjb25kaXRpb24gb2YgW3RvdGFsUmVjb3Jkc10tLT5cbjxwLXRhYmxlIFt2YWx1ZV09XCJpdGVtcyA/PyBbXVwiIFtsYXp5XT1cInRydWVcIlxuICBbcGFnaW5hdG9yXT1cInRydWVcIiBbYWx3YXlzU2hvd1BhZ2luYXRvcl09XCJmYWxzZVwiIFt0b3RhbFJlY29yZHNdPVwidG90YWxJdGVtcyA/PyBpdGVtcz8ubGVuZ3RoID8/IDBcIiBbcm93c109XCJwYWdlU2l6ZVwiXG4gIFtzaG93Q3VycmVudFBhZ2VSZXBvcnRdPVwidHJ1ZVwiIGN1cnJlbnRQYWdlUmVwb3J0VGVtcGxhdGU9XCJ7Zmlyc3R9IC0ge2xhc3R9IGRpIHt0b3RhbFJlY29yZHN9XCJcbiAgW3Jvd3NQZXJQYWdlT3B0aW9uc109XCJbNSwgMTAsIDI1LCAxMDBdXCIgKG9uU29ydCk9XCJzb3J0KCRldmVudClcIiAob25QYWdlKT1cInBhZ2VDaGFuZ2UoJGV2ZW50KVwiPlxuXG4gIDwhLS0gVGFibGUgZmlsdGVycyBhbmQgYWN0aW9ucyAtLT5cbiAgQGlmIChmaWx0ZXJzPy5sZW5ndGggfHwgZ2xvYmFsQWN0aW9ucz8ubGVuZ3RoKSB7XG4gICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImNhcHRpb25cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyIG92ZXJmbG93LWF1dG8gcC0zXCI+XG4gICAgICAgIDxhcHAtZmlsdGVyIFtmaWx0ZXJzXT1cImZpbHRlcnNcIiAob25GaWx0ZXIpPVwiZmlsdGVyKCRldmVudClcIiBjbGFzcz1cImZsZXgtZ3Jvdy0xXCIgLz5cbiAgICAgICAgQGlmIChnbG9iYWxBY3Rpb25zPy5sZW5ndGgpIHtcbiAgICAgICAgICA8YXBwLWFjdGlvbiBbYWN0aW9uc109XCJnbG9iYWxBY3Rpb25zXCIgY2xhc3M9XCJtcy0yXCI+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgI3RlbXBsYXRlIGxldC1hY3Rpb24+XG4gICAgICAgICAgICAgIDxwLWJ1dHRvbiBbbGFiZWxdPVwiYWN0aW9uLmxhYmVsXCIgc3R5bGVDbGFzcz1cInAtYnV0dG9uLXByaW1hcnkgbXMtMlwiIC8+XG4gICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgIDwvYXBwLWFjdGlvbj5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgfVxuXG4gIDwhLS0gVGFibGUgaGVhZGVyIC0tPlxuICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiaGVhZGVyXCI+XG4gICAgPHRyPlxuICAgICAgQGZvciAoY29sdW1uIG9mIGNvbHVtbnM7IHRyYWNrIGNvbHVtbikge1xuICAgICAgICA8dGggW3BTb3J0YWJsZUNvbHVtbl09XCJjb2x1bW4uc29ydFwiPlxuICAgICAgICAgIHt7Y29sdW1uLm5hbWV9fSBcbiAgICAgICAgICBAaWYgKGNvbHVtbi5zb3J0KSB7XG4gICAgICAgICAgICA8cC1zb3J0SWNvbiBbZmllbGRdPVwiY29sdW1uLnNvcnRcIiAvPlxuICAgICAgICAgICAgfVxuICAgICAgPC90aD5cbiAgICB9XG4gICAgQGlmIChhY3Rpb25zKSB7XG4gICAgICA8dGggY2xhc3M9XCJ0ZXh0LWVuZFwiPjwvdGg+XG4gICAgfVxuICA8L3RyPlxuPC9uZy10ZW1wbGF0ZT5cblxuPCEtLSBUYWJsZSBib2R5IC0tPlxuPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImJvZHlcIiBsZXQtaXRlbT5cbiAgPHRyPlxuICAgIEBmb3IgKGNvbHVtbiBvZiBjb2x1bW5zOyB0cmFjayBjb2x1bW4pIHtcbiAgICAgIDx0ZD5cbiAgICAgICAgPG5nLWNvbnRhaW5lciBbbmdUZW1wbGF0ZU91dGxldF09XCJjb2x1bW4udGVtcGxhdGUgPyBnZXRUZW1wbGF0ZShjb2x1bW4udGVtcGxhdGUpIDogdGFibGVUZW1wbGF0ZVwiXG4gICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgJGltcGxpY2l0OiBpdGVtLCBjb2x1bW4gfVwiIC8+XG4gICAgICA8L3RkPlxuICAgIH1cbiAgICBAaWYgKGFjdGlvbnMpIHtcbiAgICAgIDx0ZCBjbGFzcz1cInRleHQtZW5kXCI+XG4gICAgICAgIDxhcHAtYWN0aW9uIFthY3Rpb25zXT1cImFjdGlvbnNcIiBbZGF0YV09XCJpdGVtXCIgLz5cbiAgICAgIDwvdGQ+XG4gICAgfVxuICA8L3RyPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImVtcHR5bWVzc2FnZVwiPlxuICA8dHI+XG4gICAgPHRkIFthdHRyLmNvbHNwYW5dPVwiMTAwXCI+XG4gICAgICB7eyAnTmVzc3VuIGVsZW1lbnRvIGRhIHZpc3VhbGl6emFyZScgfX1cbiAgICA8L3RkPlxuICA8L3RyPlxuPC9uZy10ZW1wbGF0ZT5cbjwvcC10YWJsZT5cblxuPCEtLSBUYWJsZSBkYXRhIHRlbXBsYXRlIC0tPlxuPG5nLXRlbXBsYXRlICN0YWJsZVRlbXBsYXRlIGxldC1pdGVtIGxldC1jb2x1bW49XCJjb2x1bW5cIj5cbiAgQHN3aXRjaCAoY29sdW1uLnR5cGUpIHtcbiAgICAgICAgQGNhc2UgKERhdGFUeXBlLkRhdGUpIHtcbiAgICAgICAgICAgIHt7IGNvbHVtbi52YWx1ZShpdGVtKSB8IGRhdGU6ICdkZC9NTS95eXl5JyB9fVxuICAgICAgICB9XG4gICAgICAgIEBjYXNlIChEYXRhVHlwZS5EYXRlVGltZSkge1xuICAgICAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pIHwgZGF0ZTogJ2RkL01NL3l5eXksIGhoOm1tJyB9fVxuICAgICAgICB9XG4gICAgICAgIEBjYXNlIChEYXRhVHlwZS5BbW91bnQpIHtcbiAgICAgICAgICAgIHt7IGNvbHVtbi52YWx1ZShpdGVtKSB8IGN1cnJlbmN5OiAnRVVSJzogJ3N5bWJvbCcgOiB1bmRlZmluZWQ6ICdpdC1JVCcgfX1cbiAgICAgICAgfVxuICAgICAgICBAY2FzZSAoRGF0YVR5cGUuQm9vbCkge1xuICAgICAgICAgICAge3sgY29sdW1uLnZhbHVlKGl0ZW0pID8gJ1NpJzogJ05vJyB9fVxuICAgICAgICA8IS0tIC8vIFRPRE86IFRyYW5zbGF0ZSAtLT5cbiAgICAgICAgfVxuICAgICAgICBAY2FzZSAoRGF0YVR5cGUuQ29sb3IpIHtcbiAgICAgICAgICAgIDxpIGNsYXNzPVwiYmkgYmktY2lyY2xlLWZpbGxcIiBbc3R5bGUuY29sb3JdPVwiY29sdW1uLnZhbHVlKGl0ZW0pXCI+PC9pPlxuICAgICAgICB9XG4gICAgICAgIEBkZWZhdWx0IHtcbiAgICAgICAgICAgIHt7IGNvbHVtbi52YWx1ZShpdGVtKSB9fVxuICAgICAgICB9XG4gICAgfVxuICA8L25nLXRlbXBsYXRlPiJdfQ==