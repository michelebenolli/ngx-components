<!-- // TODO: Show paginator only when paging is active... -->
<!-- // TODO: Check the condition of [totalRecords]-->
<p-table [value]="items ?? []" [lazy]="true"
  [paginator]="true" [alwaysShowPaginator]="false" [totalRecords]="totalItems ?? items?.length ?? 0" [rows]="pageSize"
  [showCurrentPageReport]="true" currentPageReportTemplate="{first} - {last} di {totalRecords}"
  [rowsPerPageOptions]="[5, 10, 25, 100]" (onSort)="sort($event)" (onPage)="pageChange($event)">

  <!-- Table filters and actions -->
  @if (filters?.length || globalActions?.length) {
    <ng-template pTemplate="caption">
      <div class="d-flex align-items-center overflow-auto p-3">
        <app-filter [filters]="filters" (onFilter)="filter($event)" class="flex-grow-1" />
        @if (globalActions?.length) {
          <app-action [actions]="globalActions" class="ms-2">
            <ng-template #template let-action>
              <p-button [label]="action.label" styleClass="p-button-primary ms-2" />
            </ng-template>
          </app-action>
        }
      </div>
    </ng-template>
  }

  <!-- Table header -->
  <ng-template pTemplate="header">
    <tr>
      @for (column of columns; track column) {
        <th [pSortableColumn]="column.sort">
          {{column.name}} 
          @if (column.sort) {
            <p-sortIcon [field]="column.sort" />
            }
      </th>
    }
    @if (actions) {
      <th class="text-end"></th>
    }
  </tr>
</ng-template>

<!-- Table body -->
<ng-template pTemplate="body" let-item>
  <tr>
    @for (column of columns; track column) {
      <td>
        <ng-container [ngTemplateOutlet]="column.template ? getTemplate(column.template) : tableTemplate"
          [ngTemplateOutletContext]="{ $implicit: item, column }" />
      </td>
    }
    @if (actions) {
      <td class="text-end">
        <app-action [actions]="actions" [data]="item" />
      </td>
    }
  </tr>
</ng-template>

<ng-template pTemplate="emptymessage">
  <tr>
    <td [attr.colspan]="100">
      {{ 'Nessun elemento da visualizzare' }}
    </td>
  </tr>
</ng-template>
</p-table>

<!-- Table data template -->
<ng-template #tableTemplate let-item let-column="column">
  @switch (column.type) {
        @case (DataType.Date) {
            {{ column.value(item) | date: 'dd/MM/yyyy' }}
        }
        @case (DataType.DateTime) {
            {{ column.value(item) | date: 'dd/MM/yyyy, hh:mm' }}
        }
        @case (DataType.Amount) {
            {{ column.value(item) | currency: 'EUR': 'symbol' : undefined: 'it-IT' }}
        }
        @case (DataType.Bool) {
            {{ column.value(item) ? 'Si': 'No' }}
        <!-- // TODO: Translate -->
        }
        @case (DataType.Color) {
            <i class="bi bi-circle-fill" [style.color]="column.value(item)"></i>
        }
        @default {
            {{ column.value(item) }}
        }
    }
  </ng-template>